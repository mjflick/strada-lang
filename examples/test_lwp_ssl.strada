# Test LWP_SSL - HTTPS support

use lib "lib";
use LWP_SSL;

func main() int {
    say("=== LWP_SSL Test ===");
    say("");

    # Check if SSL is available
    if (!LWP_SSL::ssl_available()) {
        say("SSL library not available.");
        say("To enable HTTPS, build the SSL library:");
        say("  cd lib/ssl && make");
        say("");
        say("Testing HTTP only...");
    } else {
        say("SSL library loaded successfully!");
    }

    say("");

    # Test HTTP (should always work)
    say("Testing HTTP...");
    my hash %resp = LWP_SSL::get("http://example.com");
    if ($resp{"success"}) {
        say("HTTP GET: OK (status " . $resp{"status"} . ")");
    } else {
        say("HTTP GET: FAILED");
        if (defined($resp{"error"})) {
            say("  Error: " . $resp{"error"});
        }
    }

    # Test HTTPS (requires SSL library)
    say("");
    say("Testing HTTPS...");
    my hash %resp2 = LWP_SSL::get("https://example.com");
    if ($resp2{"success"}) {
        say("HTTPS GET: OK (status " . $resp2{"status"} . ")");
        my str $content = $resp2{"content"};
        if (length($content) > 100) {
            say("  Content: " . substr($content, 0, 100) . "...");
        }
    } else {
        say("HTTPS GET: FAILED");
        if (defined($resp2{"error"})) {
            say("  Error: " . $resp2{"error"});
        }
    }

    say("");
    say("Done.");
    return 0;
}
