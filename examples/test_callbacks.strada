/*
 * This file is part of the Strada Language (https://github.com/mjflick/strada-lang).
 * Copyright (c) 2026 Michael J. Flickinger
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, version 2.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

# test_callbacks.strada - Test callbacks and higher-order patterns

# Callback functions
func on_start() void {
    say("  [callback] Starting...");
}

func on_progress(int $percent) void {
    say("  [callback] Progress: " . $percent . "%");
}

func on_complete(str $result) void {
    say("  [callback] Complete: " . $result);
}

func on_error(str $msg) void {
    say("  [callback] ERROR: " . $msg);
}

# Event handler struct with multiple callbacks
struct EventHandler {
    str name;
    func() void on_start;
    func(int) void on_progress;
    func(str) void on_complete;
    func(str) void on_error;
}

# A process that uses callbacks
func run_process(EventHandler $handler) void {
    say("Running process: " . $handler->name);
    
    # Call start callback
    $handler->on_start();
    
    # Simulate progress
    $handler->on_progress(25);
    $handler->on_progress(50);
    $handler->on_progress(75);
    $handler->on_progress(100);
    
    # Call complete callback
    $handler->on_complete("Success!");
}

func main() int {
    say("╔══════════════════════════════════════╗");
    say("║  Callbacks & Events Test             ║");
    say("╚══════════════════════════════════════╝");
    say("");
    
    # Create an event handler with callbacks
    my EventHandler $handler;
    $handler->name = "DataProcessor";
    $handler->on_start = &on_start;
    $handler->on_progress = &on_progress;
    $handler->on_complete = &on_complete;
    $handler->on_error = &on_error;
    
    # Run the process
    run_process($handler);
    
    say("");
    say("╔══════════════════════════════════════╗");
    say("║  ✓ Callbacks working!                ║");
    say("╚══════════════════════════════════════╝");
    
    return 0;
}
